{% extends 'layout.html' %}

{% block body %}
<div class="row">
 <div class="col-md-12 well">
 {% with messages = get_flashed_messages() %}
   {% if messages %}
   <div class="alert alert-block alert-danger fade in">
    <a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>
    <h3>Message</h3>
    {% for message in messages %}
    <p>{{ message }}</p>
    {% endfor %}
   </div>
   {% endif %}
 {% endwith %}
 {% if user.is_authenticated() %}
  <h2>Your Badge Information</h2>
 {% else %}
  <h1>Earn your Open Badge for this Session!</h1>
 {% endif %}
  <div class="row">
   <div class="col-md-3">
    <img src="{{ url_for('static', filename='img/bibframe-rda-badge.png') }}" class="img-thumbnail"></img>
    <hr>
    <div class="alert">
     <h3>Share your accomplishment</h3>
     <p>
      <a href="#">LinkedIn</a> 
     </p>
     <p>
      <a href="#">Twitter</a>
     </p>
     <p>
      <a href="#">Facebook</a>
     </p>

    </div>
   </div>
   {% if not user.is_authenticated() %}
   <div class="col-md-8">
     <ol>
       <h2><li>Create an Mozilla Open Badge Backpack Account</li></h2>
       <p class="lead">
        Create an Mozilla Open Badge Backpack Account 
        <a href="http://backpack.openbadges.org/backpack/login">Backpack Account</a>
       </p>
       <h2><li>Login or Register your E-mail</li></h2>
       <div class="panel">
         <h3>Login with your Gmail Account</h3>
         
       </div>
       <h1>OR</h1>
        <h3>Register your E-mail</h3>
       <div class="alert alert-info" >
        <form class="form-inline" action="/calcon-2013-session/register" method="POST">
         <div class="form-group">
           <label for="email_address">Email address*</label>
           <input type="email" class="form-control" name="email_address"></input>
         </div>
         <div class="form-group">
           <label for="password">Password</label>
           <input type="password" class="form-control" name="password"></input>
          </div>
         <div class="form-group">
           <label for="copy-password">Retype Password</label>
           <input type="password" class="form-control" name="copy-password"></input>
           <button type="submit" class="btn btn-default">Sign-up</button>
           <p>
            <small>
             * Your email address will only be used to issue your badge for this
               session and nothing else.
            </small>
           </p>
         </div>
        </form>
       </div>
       <h2>
        <li>Fulfill Badge Critera</li>
       </h2>
       <div class="panel">
         <p>
          For each slide in this presentation, take the badge quiz and get 2/3 questions
          right.  
         </p>
         <div class="panel-body">
           <ul>
            {% for slide in slides.bibframe %}
            <li><a href="/calcon-2013-session/bibframe/{{ slide.name }}#quiz">{{ slide.label }} Badge Quiz</a></li>
            {% endfor %}
           </ul>
         </div>
       </div>
     </ol>
   </div>
   {% else %}
   <div class="col-md-8">
     <dl>
       <dt>Registered email:</dt>
       <dd><span data-bind="visible: !editEmailmode(), text: emailValue, click: editEmail">&nbsp;</span>
           <input type="email" class="form-control" 
                  data-bind="visible: editEmailmode, value: emailValue , hasFocus: editEmailmode">
       </dd>
     </dl>
     <table class="table table-striped table-bordered">
      <thead>
        <tr>
         <th>Slide</th>
         <th>Taken on</th>
         <th>Question 1</th>
         <th>Question 2</th>
         <th>Question 3</th>
         <th>Total</th>
        </tr>
      </thead>
      <tbody>
      {% for row in user.get_badge().get('quiz_results') %}
       <tr>
         <td>{{ row.label }}</td>
         <td>{{ row.taken }}</td>
         <td>{{ row.q1 }}</td>
         <td>{{ row.q2 }}</td>
         <td>{{ row.q3 }}</td>
         <td>{{ row.total }}</td>
       </tr>
      {% endfor %}
      </tbody>
     </table>      
   {% endif %}
  </div>
 </div>
</div>
{% endblock %}

{% block more_js %}
<script>
var BadgeManagerViewModel = function() {
  var self=this;
 
  {% if user.is_authenticated() %} 
  self.editEmailmode = ko.observable(false);
  self.emailValue = ko.observable("{{ user.email }}");
  self.editEmail = function() { self.editEmailmode(true); }
  {% endif %}
}
ko.applyBindings(new BadgeManagerViewModel());
</script>
{% endblock %}
